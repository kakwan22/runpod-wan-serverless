# EXTENDS BASE IMAGE WITH MODELS 
FROM kakwan22/wanrunpod:latest

# Set working directory to ComfyUI
WORKDIR /ComfyUI

# HF token for model downloads
ARG HF_TOKEN
ENV HF_TOKEN=$HF_TOKEN

# Force cache bust for model downloads - v6
RUN echo "Model download cache bust v6"

# Ensure directories exist and clean up any existing models
RUN mkdir -p models/checkpoints models/clip_vision && \
    rm -rf models/checkpoints/* models/clip_vision/* || true

# Download models directly with absolute paths (no conditionals for now)
RUN echo "Starting model downloads..." && \
    hf download --local-dir /ComfyUI/models/checkpoints Phr00t/WAN2.2-14B-Rapid-AllInOne v10/wan2.2-i2v-rapid-aio-v10-nsfw.safetensors && \
    echo "WAN model downloaded, checking size..." && \
    ls -la /ComfyUI/models/checkpoints/ && \
    echo "Starting CLIP Vision download..." && \
    hf download --local-dir /ComfyUI/models/clip_vision lllyasviel/misc clip_vision_vit_h.safetensors && \
    echo "CLIP Vision downloaded, checking size..." && \
    ls -la /ComfyUI/models/clip_vision/ && \
    echo "All downloads complete!"